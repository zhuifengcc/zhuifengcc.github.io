---
title: 'Spring Cloud：Spring Cloud Eureka'
date: 2018-05-29 15:31:15
tags:
---

## 服务治理
服务治理是微服务架构中最为核心和基础的模块，主要用来实现各个微服务实例的自动化注册与发现。

服务注册:服务治理框架中，通常会构建一个注册中心，每个服务单位向注册中心登记自己提供的服务，将主机与端口号、版本号、通讯协议等一些附加信息告知注册中心，注册中心按照服务名分类组织服务清单。服务注册中心会以心跳的方式去监测清单中的服务是否可用，剔除不可用的服务，达到排除故障服务的效果。
服务发现：调用方需要向服务注册中心咨询服务，并获取所有服务的实例清单，以实现对具体服务实例的访问。
## Netflix Eureka
Spring Cloud Eureka,使用Netflix Eureka来实现服务注册与发现，它既包含了服务端组件，又包含了客户端组件。

Eureka服务端，我们也成为服务注册中心。支持高可用配置，依托于强一致性提供良好的服务实例可用性，可以应对多种不同的故障场景。如Eureka集群，分片故障，Eureka进入自我保护，允许在故障时提供服务的注册与发现，不同可用区域的服务注册中心通过异步模式互相复制各自的状态。

Eureka客户端，处理服务的注册与发现。客户端通过注解和参数配置的方式，嵌入在客户端应用程序的代码中，Eureka客户端向注册中心注册自身提供的服务并周期地发送心跳来更新它的服务续约。同时，它也能从服务端查询当前注册的服务信息并把它们缓存到本地并周期性地刷新服务状态。
## 高可用注册中心
在Eureka服务治理设计中，所有节点既是服务提供方，也是服务消费方，服务注册中心也不例外。

Eureka Server的高可用实际上就是讲自己作为服务向其他服务注册中心注册自己，这样就可以形成一组互相注册的服务注册中心，以实现服务清单的互相同步，达到高可用的效果。（服务注册中心集群）
## 服务发现与消费
服务消费者：发现服务及消费服务。服务发现的任务由Eureka 客户端完成，服务消费的任务由Ribbon（客户端负载均衡）完成。
<!--hello -jar的方式完成多服务实例的启动-->
## 详解Eureka
三个核心角色：服务注册中心、服务提供者以及服务消费者。实际上服务提供者多数时候也是服务消费者。

    服务注册中心：Eureka提供的服务端，提供服务注册与发现的功能
    
    服务提供者：提供服务的应用，因为Spring Cloud基于Spring Boot，可以使Spring Boot应用，也可以使其他技术平台且遵循Eureka通讯机制的应用。

    服务消费者：消费者应用从服务注册中心获取服务列表，从而使消费者可以知道去何处调用其所需要的服务。如Ribbon实现消费，Feign实现消费
治理机制：

    服务提供者：服务注册（发送REST请求，自带自身的一些元数据信息，服务注册中心收到后会把这些元数据信息存储在一个双层Map中（第一层key为服务名，第二层的key为具体服务的实例名））- 服务同步（服务注册中心集群）- 服务续约（Renew服务提供者维护心跳）

    服务消费者：获取服务（REST请求）- 服务调用（Ribbon轮询）

    服务下线：服务正常关闭操作时，发送Rest请求给Eureka Server，服务端接收后，将服务状态置为下线（Down）并传播下线事件

    服务注册中心：实效剔除、自我保护


